<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>스프링 배치 | Dev Study</title>
    <meta name="description" content="dev study blog">
    
    
    <link rel="preload" href="/devstudy/assets/css/0.styles.dac03a01.css" as="style"><link rel="preload" href="/devstudy/assets/js/app.fccfb1f1.js" as="script"><link rel="preload" href="/devstudy/assets/js/2.a249846a.js" as="script"><link rel="prefetch" href="/devstudy/assets/js/10.dff57a07.js"><link rel="prefetch" href="/devstudy/assets/js/11.90cabe7e.js"><link rel="prefetch" href="/devstudy/assets/js/12.653a6f0a.js"><link rel="prefetch" href="/devstudy/assets/js/13.fae6c5f0.js"><link rel="prefetch" href="/devstudy/assets/js/14.71ac308a.js"><link rel="prefetch" href="/devstudy/assets/js/15.7f7d81ac.js"><link rel="prefetch" href="/devstudy/assets/js/16.def2a4fd.js"><link rel="prefetch" href="/devstudy/assets/js/17.b0a5d87c.js"><link rel="prefetch" href="/devstudy/assets/js/18.a3edeaea.js"><link rel="prefetch" href="/devstudy/assets/js/19.398bb8dc.js"><link rel="prefetch" href="/devstudy/assets/js/20.0101abde.js"><link rel="prefetch" href="/devstudy/assets/js/21.2341ecc5.js"><link rel="prefetch" href="/devstudy/assets/js/22.1625976b.js"><link rel="prefetch" href="/devstudy/assets/js/23.1431ce35.js"><link rel="prefetch" href="/devstudy/assets/js/24.4223c62d.js"><link rel="prefetch" href="/devstudy/assets/js/25.7ec87ac8.js"><link rel="prefetch" href="/devstudy/assets/js/26.91dbf76a.js"><link rel="prefetch" href="/devstudy/assets/js/27.d7030d38.js"><link rel="prefetch" href="/devstudy/assets/js/28.c5968c26.js"><link rel="prefetch" href="/devstudy/assets/js/3.5c531c6a.js"><link rel="prefetch" href="/devstudy/assets/js/4.24fb08a8.js"><link rel="prefetch" href="/devstudy/assets/js/5.025a02dd.js"><link rel="prefetch" href="/devstudy/assets/js/6.cad38649.js"><link rel="prefetch" href="/devstudy/assets/js/7.8534a7d8.js"><link rel="prefetch" href="/devstudy/assets/js/8.5c82d821.js"><link rel="prefetch" href="/devstudy/assets/js/9.c91781b1.js">
    <link rel="stylesheet" href="/devstudy/assets/css/0.styles.dac03a01.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devstudy/" class="home-link router-link-active"><!----> <span class="site-name">Dev Study</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/devstudy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/devstudy/yukyung/" class="nav-link">김유경</a></div><div class="nav-item"><a href="/devstudy/jju/" class="nav-link">황주리</a></div><div class="nav-item"><a href="/devstudy/ma/" class="nav-link">마성민</a></div><div class="nav-item"><a href="/devstudy/been/" class="nav-link">백승빈</a></div><div class="nav-item"><a href="/devstudy/swchoi/" class="nav-link router-link-active">최승원</a></div><div class="nav-item"><a href="/devstudy/jjong/" class="nav-link">윤종원</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">강은지</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devstudy/oriri/javascript/" class="nav-link">JAVASCRIPT</a></li><li class="dropdown-item"><!----> <a href="/devstudy/oriri/java/" class="nav-link">JAVA</a></li></ul></div></div><div class="nav-item"><a href="/devstudy/rnmkr/" class="nav-link">박현우</a></div> <a href="https://github.com/devstudyy/devstudy" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/devstudy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/devstudy/yukyung/" class="nav-link">김유경</a></div><div class="nav-item"><a href="/devstudy/jju/" class="nav-link">황주리</a></div><div class="nav-item"><a href="/devstudy/ma/" class="nav-link">마성민</a></div><div class="nav-item"><a href="/devstudy/been/" class="nav-link">백승빈</a></div><div class="nav-item"><a href="/devstudy/swchoi/" class="nav-link router-link-active">최승원</a></div><div class="nav-item"><a href="/devstudy/jjong/" class="nav-link">윤종원</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">강은지</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devstudy/oriri/javascript/" class="nav-link">JAVASCRIPT</a></li><li class="dropdown-item"><!----> <a href="/devstudy/oriri/java/" class="nav-link">JAVA</a></li></ul></div></div><div class="nav-item"><a href="/devstudy/rnmkr/" class="nav-link">박현우</a></div> <a href="https://github.com/devstudyy/devstudy" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>DOCUMENT</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/devstudy/swchoi/SpringBatch.html" class="active sidebar-link">스프링 배치</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/devstudy/swchoi/SpringBatch.html#batch-배치-어플리케이션이란" class="sidebar-link">Batch(배치) 어플리케이션이란?</a></li><li class="sidebar-sub-header"><a href="/devstudy/swchoi/SpringBatch.html#spring-batch-프로젝트-생성하기" class="sidebar-link">Spring Batch 프로젝트 생성하기</a></li><li class="sidebar-sub-header"><a href="/devstudy/swchoi/SpringBatch.html#메타테이블-생성" class="sidebar-link">메타테이블 생성</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="스프링-배치"><a href="#스프링-배치" aria-hidden="true" class="header-anchor">#</a> 스프링 배치</h1> <h2 id="batch-배치-어플리케이션이란"><a href="#batch-배치-어플리케이션이란" aria-hidden="true" class="header-anchor">#</a> Batch(배치) 어플리케이션이란?</h2> <div class="language- extra-class"><pre class="language-text"><code> 배치(Batch)는 일괄처리란 뜻을 갖고 있습니다.
</code></pre></div><p>만약 매일 전 날의 데이터를 집계 해야한다고 가정해보겠습니다.
이 집계 과정을 어디서 수행하면 좋을까요?
웹 어플리케이션 밖에 모른다면 Tomcat + Spring MVC를 떠올리실것 같습니다.
하지만 이렇게 큰 데이터를 읽고, 가공하고, 저장한다면 해당 서버는 순식간에 CPU, I/O 등의 자원을 다 써버려서 다른 Request 처리를 못하게 됩니다.</p> <p>그리고 이 집계 기능은 <strong>하루에 1번 수행</strong>됩니다.
이를 위해 API를 구성하는 것은 너무 낭비가 아닐까요?
여기서 추가로 데이터가 너무 많아서 처리중에 실패가 나면 어떻게 될까요?
5만번째에서 실패했다면, 5만 1번째부터 다시 실행할 수 있다면 얼마나 좋을까요?</p> <p>또 이런 경우도 있을수 있습니다.
오늘 아침 누군가가 집계 함수를 실행시켰는데, 다른 누군가가 또 실행시켜 집계 데이터가 2배로 뻥튀기 될 수도 있습니다.
같은 파라미터로 같은 함수를 실행할 경우 이미 실행한 적이 있어 실패하는 기능을 지원한다면 얼마나 좋을까요?</p> <p>바로 이런 단발성으로 대용량의 데이터를 처리하는 어플리케이션을 배치 어플리케이션이라고 합니다.</p> <p>Spring 진영에선 <strong>Spring Batch</strong>가 있습니다.</p> <p>Spring Batch를 소개하기전에 배치 어플리케이션이란 어떤 것인지 그 조건을 잠깐 이야기해보겠습니다.
배치 어플리케이션은 다음의 조건을 만족해야만 합니다.</p> <ul><li>대용량 데이터 - 배치 어플리케이션은 대량의 데이터를 가져오거나, 전달하거나, 계산하는 등의 처리를 할 수 ​​있어야 합니다.</li> <li>자동화 - 배치 어플리케이션은 심각한 문제 해결을 제외하고는 <strong>사용자 개입 없이 실행</strong>되어야 합니다.</li> <li>견고성 - 배치 어플리케이션은 잘못된 데이터를 충돌/중단 없이 처리할 수 있어야 합니다.</li> <li>신뢰성 - 배치 어플리케이션은 무엇이 잘못되었는지를 추적할 수 있어야 합니다. (로깅, 알림)</li> <li>성능 - 배치 어플리케이션은 <strong>지정한 시간 안에 처리를 완료</strong>하거나 동시에 실행되는 <strong>다른 어플리케이션을 방해하지 않도록 수행</strong>되어야합니다.</li></ul> <h3 id="spring-batch"><a href="#spring-batch" aria-hidden="true" class="header-anchor">#</a> Spring Batch?</h3> <p>Spring Batch 프로젝트는 Accenture와 Spring Source의 공동 작업으로 2007년에 탄생했습니다.
Accenture는 수년간의 노력으로 그들만의 배치 프레임워크를 만들었고, 그를 통해 얻은 경험을 가지고 있었습니다.
즉, Accenture의 배치 노하우 &amp; 기술력과 Spring 프레임워크가 합쳐져 만들어진 것이 <strong>Spring Batch</strong> 입니다.</p> <p>Spring Batch는 Spring의 특성을 그대로 가져왔습니다.
그래서 <strong>DI, AOP, 서비스 추상화</strong> 등 Spring 프레임워크의 3대 요소를 모두 사용할 수 있으면서, Accenture의 Batch 노하우가 담긴 아키텍처를 사용할 수 있습니다.</p> <p>현재 Spring Batch 4.0 (Spring Boot 2.0) 에서 지원하는 Reader &amp; Writer는 아래와 같습니다.
(Reader는 데이터를 읽어오는 모듈이며, Writer는 데이터를 쓰는 모듈이라고 생각하시면 됩니다.)</p> <table><thead><tr><th>DataSource</th> <th style="text-align:center">기술</th> <th style="text-align:center">설명</th></tr></thead> <tbody><tr><td>Database</td> <td style="text-align:center">JDBC</td> <td style="text-align:center">페이징,커서,일괄 업데이트등 사용가능</td></tr> <tr><td>Database</td> <td style="text-align:center">Hibernate</td> <td style="text-align:center">페이징,커서 사용가능</td></tr> <tr><td>Database</td> <td style="text-align:center">JPA</td> <td style="text-align:center">페이징 사용 가능</td></tr> <tr><td>File</td> <td style="text-align:center">Flat file</td> <td style="text-align:center">지정한 구분자로 파싱 지원</td></tr> <tr><td>File</td> <td style="text-align:center">XML</td> <td style="text-align:center">XML 파싱 지원</td></tr></tbody></table> <div class="language- extra-class"><pre class="language-text"><code> iBatis 모듈은 현재 삭제되었습니다. 
 iBatis를 reader로 사용하셨던 분들은 JDBC ItemReader로 교체하시길 추천드립니다.
</code></pre></div><h3 id="batch-사례"><a href="#batch-사례" aria-hidden="true" class="header-anchor">#</a> Batch 사례</h3> <p><strong>일매출 집계</strong></p> <p>많은 거래가 이루어지는 커머스 사이트의 경우 하루 거래건이 50만 ~ 100만까지 나옵니다.
이럴 경우 이와 관련된 데이터는 최소 100만 ~ 200만 row 이상입니다.
한달이면 5000만 ~ 1억까지 될수도 있습니다.</p> <p>이를 실시간 집계 쿼리로 해결하기엔 조회 시간이나 서버 부하가 심합니다.
그래서 매일 새벽에 전날의 매출 집계 데이터를 만들어서 외부 요청이 올 경우 미리 만들어준 집계 데이터를 바로 전달하면 성능과 부하를 모두 잡을 수 있습니다.
<img src="/devstudy/assets/img/batch.6805337a.png" alt="batch sample"></p> <h2 id="spring-batch-프로젝트-생성하기"><a href="#spring-batch-프로젝트-생성하기" aria-hidden="true" class="header-anchor">#</a> Spring Batch 프로젝트 생성하기</h2> <p>기본적인 프로젝트 개발 환경은 다음과 같습니다.</p> <ul><li>IntelliJ IDEA 2019.1</li> <li>Spring Boot</li> <li>Java 11</li> <li>Maven</li></ul> <p><code>이를 기반하여 프로젝트 생성을 시작하겠습니다.</code></p> <p>먼저 Spring Boot 프로젝트를 나타내는 Spring Initializr (Spring Boot)를 선택합니다.</p> <p><img src="/devstudy/assets/img/springBatch1.01cc9a72.png" alt="batch project"></p> <p>본인만의 Group, Artfact를 선택하시고 Maven 프로젝트를 선택합니다.</p> <p><img src="/devstudy/assets/img/springBatch2.0327564f.png" alt="batch project"></p> <p>이후 Spring 의존성을 선택하는 화면에선 아래와 같이 선택합니다.</p> <p><img src="/devstudy/assets/img/springBatch3.352544fb.png" alt="batch project"></p> <h3 id="simple-job-생성하기"><a href="#simple-job-생성하기" aria-hidden="true" class="header-anchor">#</a> Simple Job 생성하기</h3> <p>Batch Job을 만들기 전에, <code>BatchdemoApplication.java</code>에 다음과 같이 <strong>Spring Batch 기능 활성화</strong> 어노테이션 <code>@EnableBatchProcessing</code>을 추가합니다.</p> <p><img src="/devstudy/assets/img/springBatch5.c37ed36b.png" alt="batch Simple Job"></p> <p>이 어노테이션을 선언하면, Spring Batch의 여러 기능들을 사용할 수 있게 됩니다.
선언하지 않으시면 Spring Batch 기능을 사용할 수 없기 때문에 <strong>필수로 선언</strong>하셔야만 합니다.</p> <p>설정이 끝나셨으면 패키지 아래에 job 패키지를 생성하고, <code>SimpleJobConfiguration.java</code> 파일을 생섭합니다.</p> <p><img src="/devstudy/assets/img/springBatch7.dd351824.png" alt="batch Simple Job"></p> <ul><li><code>@Conifguration</code> <ul><li>Spring Batch의 모든 Job은 <code>@Conifguration</code>으로 등록해서 사용합니다.</li></ul></li> <li><code>jobBuilderFactory.get(&quot;simpleJob)</code> <ul><li><code>simpleJob</code>이란 이름의 Batch Job을 생성합니다.</li> <li>job의 이름은 별도로 지정하지 않고, 이렇게 Builder를 통해 지정합니다.</li></ul></li> <li><code>stepBuilderFactory.get(&quot;simpleStep1&quot;)</code> <ul><li><code>simpleStep1</code> 이란 이름의 Batch Step을 생성합니다.</li> <li><code>jobBuilderFactory.get(&quot;simpleJob&quot;)</code>와 마찬가지로 Builder를 통해 이름을 지정합니다.</li></ul></li> <li><code>.tasklet((contribution, chunkContext))</code> <ul><li>Step 안에서 수행될 기능들을 명시합니다.</li> <li>여기서는 Batch가 수행되면 <code>log.info(&quot;&gt;&gt;&gt;&gt;&gt; This is Step1&quot;)</code> 가 출력되도록 합니다.</li></ul></li></ul> <p>Batch Job을 생성하는 <strong>simpleJob 코드를 보시면 simpleStep1을 품고 있음</strong>을 알 수 있습니다.
Spring Batch에서 <strong>Job은 하나의 배치 작업 단위</strong>를 얘기하는데요.
Job 안에는 아래처럼 여러 Step이 존재하고, Step 안에 Tasklet 혹은 Reader &amp; Processor &amp; Writer 묶음이 존재합니다.</p> <p><img src="/devstudy/assets/img/springBatch6.8987c9a9.png" alt="batch Simple Job"></p> <p>Job안에 여러 Step이 있다는건 쉽게 이해되지만, Step이 품고 있는 단위가 애매하게 보이실 수 있습니다.</p> <p><strong>Tasklet 하나와 Reader &amp; Processor &amp; Writer 한 묶음이 같은 레벨</strong>입니다.
그래서 <strong>Reader &amp; Processor가 끝나고 Tasklet으로 마무리 짓는 등으로 만들순 없다</strong>는걸 꼭 명심해주셔야 합니다.</p> <div class="language- extra-class"><pre class="language-text"><code>Tasklet은 어찌보면 Spring MVC의 @Component, @Bean과 비슷한 역할이라고 보셔도 될 것 같습니다. 
명확한 역할은 없지만, 개발자가 지정한 커스텀한 기능을 위한 단위로 보시면 됩니다.
</code></pre></div><p>자 그럼 한번 이 간단한 Spring Batch 어플리케이션을 실행해보겠습니다.
처음 만들어졌던 <code>BatchdemoApplication.java</code>의 <code>main</code> 메소드를 실행하면 Batch가 실행됩니다.</p> <p><img src="/devstudy/assets/img/springBatch8.cd142c6c.png" alt="batch Simple Job"></p> <p>실행해보시면 아래처럼 <code>log.info(&quot;&gt;&gt;&gt;&gt;&gt; This is Step1&quot;)</code>가 잘 수행되어 로그가 찍힌것을 알 수 있습니다.</p> <p><img src="/devstudy/assets/img/springBatch4.7a5a7a79.png" alt="batch Simple Job"></p> <p>처음으로 Spring Batch 프로그램을 작성해보았습니다!</p> <h2 id="메타테이블-생성"><a href="#메타테이블-생성" aria-hidden="true" class="header-anchor">#</a> 메타테이블 생성</h2></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/devstudyy/devstudy/edit/master/docs/swchoi/SpringBatch.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/9/2019, 8:48:40 PM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/devstudy/assets/js/app.fccfb1f1.js" defer></script><script src="/devstudy/assets/js/2.a249846a.js" defer></script>
  </body>
</html>
